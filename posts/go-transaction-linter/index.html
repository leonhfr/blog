<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=false><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="#FFFFFF"><title>I shipped a transaction bug, so I built a linter &#183; léon h</title><meta name=title content="I shipped a transaction bug, so I built a linter &#183; léon h"><script type=text/javascript src=https://leonh.fr/js/appearance.min.8a082f81b27f3cb2ee528df0b0bdc39787034cf2cc34d4669fbc9977c929023c.js integrity="sha256-iggvgbJ/PLLuUo3wsL3Dl4cDTPLMNNRmn7yZd8kpAjw="></script><link type=text/css rel=stylesheet href=https://leonh.fr/css/main.bundle.min.0dbee20661a8866b8a7bed4d7c2d4275d4b0b69d973f30d21bc8299b06751a34.css integrity="sha256-Db7iBmGohmuKe+1NfC1CddSwtp2XPzDSG8gpmwZ1GjQ="><script defer type=text/javascript id=script-bundle src=https://leonh.fr/js/main.bundle.min.08a9220ae61dd334b11a887737885eaf1530f54c827ad77237e0dba74a179ea6.js integrity="sha256-CKkiCuYd0zSxGoh3N4herxUw9UyCetdyN+Dbp0oXnqY=" data-copy=Copy data-copied=Copied></script><meta name=description content="
      Database operations leaked outside a transaction and broke prod. Here's how I built a Go linter to prevent it.
    "><link rel=canonical href=https://leonh.fr/posts/go-transaction-linter/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:url" content="https://leonh.fr/posts/go-transaction-linter/"><meta property="og:site_name" content="léon h"><meta property="og:title" content="I shipped a transaction bug, so I built a linter"><meta property="og:description" content="Database operations leaked outside a transaction and broke prod. Here's how I built a Go linter to prevent it."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2026-01-27T00:00:00+00:00"><meta property="article:modified_time" content="2026-01-27T00:00:00+00:00"><meta property="article:tag" content="Go"><meta property="article:tag" content="Databases"><meta property="article:tag" content="Static Analysis"><meta property="article:tag" content="Developer Tools"><meta name=twitter:card content="summary"><meta name=twitter:title content="I shipped a transaction bug, so I built a linter"><meta name=twitter:description content="Database operations leaked outside a transaction and broke prod. Here's how I built a Go linter to prevent it."><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","articleSection":"","name":"I shipped a transaction bug, so I built a linter","headline":"I shipped a transaction bug, so I built a linter","description":"Database operations leaked outside a transaction and broke prod. Here\u0027s how I built a Go linter to prevent it.","abstract":"\u003cp\u003eSome bugs compile cleanly, pass all tests, and slip through code reviews. I shipped one of those at work: a database transaction that silently leaked operations outside its boundary. I don\u0026rsquo;t like being stressed with a broken prod, so I built a custom linter to catch them at compile time. Here\u0026rsquo;s how.\u003c\/p\u003e","inLanguage":"en","url":"https:\/\/leonh.fr\/posts\/go-transaction-linter\/","author":{"@type":"Person","name":"léon h"},"copyrightYear":"2026","dateCreated":"2026-01-27T00:00:00\u002b00:00","datePublished":"2026-01-27T00:00:00\u002b00:00","dateModified":"2026-01-27T00:00:00\u002b00:00","keywords":["go","databases","static analysis","developer tools"],"mainEntityOfPage":"true","wordCount":"2125"}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://leonh.fr/","name":"","position":1},{"@type":"ListItem","item":"https://leonh.fr/posts/","name":"","position":2},{"@type":"ListItem","name":"I Shipped a Transaction Bug, So I Built a Linter","position":3}]}</script><meta name=author content="léon h"><link href=mailto:hello@leonh.fr rel=me><link href=https://github.com/leonhfr rel=me><link href=https://instagram.com/leonholl rel=me><link href=https://linkedin.com/in/leonhollender rel=me><script defer src=https://eu.umami.is/script.js data-website-id=a8946b2c-9fa8-4520-a0f0-8debfbe43f0a></script></head><body class="m-auto flex h-screen max-w-7xl flex-col bg-neutral px-6 text-lg leading-7 text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32"><div id=the-top class="absolute flex self-center"><a class="-translate-y-8 rounded-b-lg bg-primary-200 px-3 py-1 text-sm focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="pe-2 font-bold text-primary-600 dark:text-primary-400">&darr;</span>Skip to main content</a></div><header class="py-6 font-semibold text-neutral-900 dark:text-neutral sm:py-10 print:hidden"><nav class="flex items-start justify-between sm:items-center"><div class="flex flex-row items-center"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" rel=me href=/>léon h</a></div><ul class="flex list-none flex-col text-end sm:flex-row"><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><a href=/posts/ title><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Blog</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"></li></ul></nav></header><div class="relative flex grow flex-col"><main id=main-content class=grow><article><header class=max-w-prose><h1 class="mb-8 mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">I shipped a transaction bug, so I built a linter</h1><div class="mb-10 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2026-01-27 00:00:00 +0000 UTC">27 January 2026</time><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">10 mins</span></div></div></header><section class="prose mt-0 flex max-w-full flex-col dark:prose-invert lg:flex-row"><div class="order-first px-0 lg:order-last lg:max-w-xs lg:ps-8"><div class="toc pe-5 lg:sticky lg:top-10 print:hidden"><details open class="-ms-5 mt-0 overflow-hidden rounded-lg ps-5"><summary class="block cursor-pointer bg-neutral-100 py-1 ps-5 text-lg font-semibold text-neutral-800 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="border-s border-dotted border-neutral-300 py-2 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#the-bug-leaking-transactions>The Bug: Leaking Transactions</a></li><li><a href=#its-hard-to-catch>It&rsquo;s Hard to Catch</a></li><li><a href=#the-goanalysis-framework>The <code>go/analysis</code> Framework</a></li><li><a href=#implementation-deep-dive>Implementation Deep Dive</a><ul><li><a href=#walking-the-ast>Walking the AST</a></li><li><a href=#identifying-transaction-calls>Identifying Transaction Calls</a></li><li><a href=#tracking-the-transaction-parameter>Tracking the Transaction Parameter</a></li><li><a href=#traversing-the-callback>Traversing the Callback</a></li><li><a href=#detecting-outer-repository-method-calls>Detecting Outer Repository Method Calls</a></li><li><a href=#detecting-outer-repositories-passed-to-helper-functions>Detecting Outer Repositories Passed to Helper Functions</a></li><li><a href=#recursive-analysis-of-helper-functions>Recursive Analysis of Helper Functions</a></li></ul></li><li><a href=#testing-with-analysistest>Testing with <code>analysistest</code></a></li><li><a href=#running-the-linter>Running the Linter</a></li><li><a href=#you-should-write-your-own-linter>You Should Write Your Own Linter</a></li></ul></nav></div></details></div></div><div class="min-h-0 min-w-0 max-w-prose grow"><p>Some bugs compile cleanly, pass all tests, and slip through code reviews. I shipped one of those at work: a database transaction that silently leaked operations outside its boundary. I don&rsquo;t like being stressed with a broken prod, so I built a custom linter to catch them at compile time. Here&rsquo;s how.</p><h2 id=the-bug-leaking-transactions class="relative group">The Bug: Leaking Transactions <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#the-bug-leaking-transactions aria-label=Anchor>#</a></span></h2><p>Database transactions are essential for data integrity. Operations wrapped in a transaction are expected to display all-or-nothing behavior: either every operation succeeds, or everything rolls back.</p><p>One pattern for managing transactions is callbacks. This style of transaction is common when using ORMs such as <a href=https://gorm.io/docs/transactions.html target=_blank rel=noreferrer>Gorm</a>. However, this approach makes it easier to accidentally bypass transaction boundaries. Operations can leak outside the intended scope, leading to data corruption and race conditions. Let&rsquo;s look at some code.</p><p>At <a href=https://www.re-cap.com target=_blank rel=noreferrer>my current workplace</a>, the Go backend uses a repository pattern with explicit transactions:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>Service</span><span class=p>)</span><span class=w> </span><span class=nf>UpdateUser</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span><span class=w> </span><span class=nx>userID</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=kt>error</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>s</span><span class=p>.</span><span class=nx>repo</span><span class=p>.</span><span class=nf>Transaction</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span><span class=w> </span><span class=kd>func</span><span class=p>(</span><span class=nx>tx</span><span class=w> </span><span class=nx>models</span><span class=p>.</span><span class=nx>Repo</span><span class=p>)</span><span class=w> </span><span class=kt>error</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>user</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>tx</span><span class=p>.</span><span class=nf>GetUser</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span><span class=w> </span><span class=nx>userID</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=nx>err</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>user</span><span class=p>.</span><span class=nx>Name</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=s>&#34;Updated&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>tx</span><span class=p>.</span><span class=nf>SaveUser</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span><span class=w> </span><span class=nx>user</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>The callback receives <code>tx</code>, a transaction-scoped repository. All database operations inside must use <code>tx</code> to participate in the transaction.</p><p>This pattern works, but it&rsquo;s easy to mix up the two scopes:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>Service</span><span class=p>)</span><span class=w> </span><span class=nf>UpdateUser</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span><span class=w> </span><span class=nx>userID</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=kt>error</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>s</span><span class=p>.</span><span class=nx>repo</span><span class=p>.</span><span class=nf>Transaction</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span><span class=w> </span><span class=kd>func</span><span class=p>(</span><span class=nx>tx</span><span class=w> </span><span class=nx>models</span><span class=p>.</span><span class=nx>Repo</span><span class=p>)</span><span class=w> </span><span class=kt>error</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>user</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>s</span><span class=p>.</span><span class=nx>repo</span><span class=p>.</span><span class=nf>GetUser</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span><span class=w> </span><span class=nx>userID</span><span class=p>)</span><span class=w> </span><span class=c1>// Bug: uses s.repo, not tx.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=nx>err</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>user</span><span class=p>.</span><span class=nx>Name</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=s>&#34;Updated&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>tx</span><span class=p>.</span><span class=nf>SaveUser</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span><span class=w> </span><span class=nx>user</span><span class=p>)</span><span class=w> </span><span class=c1>// Ok: inside the transaction.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>The <code>GetUser</code> call uses <code>s.repo</code> (the component&rsquo;s field) instead of <code>tx</code> (the transaction callback parameter). This operation executes outside the transaction boundary.</p><p>This mistake is easy to miss because the code often appears to work correctly. It typically happens when wrapping existing code in a transaction and forgetting to update one reference.</p><h2 id=its-hard-to-catch class="relative group">It&rsquo;s Hard to Catch <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#its-hard-to-catch aria-label=Anchor>#</a></span></h2><p>What&rsquo;s more, this bug is insidious and hard to catch. The code compiles without error. Tests pass because they run in isolation with no contention. Failures are unpredictable and usually only happen under load. Worst of all, the failure mode is often silent data corruption, not loud and easy-to-diagnose crashes.</p><p>It&rsquo;s also easy to miss in code reviews, especially when the bug is nested a few functions deep. AI review tools only caught it when it was obvious, so they were not reliable enough. After some of these slipped through and resulted in <del>me banging my head against the wall</del> long debugging sessions, I decided to find a more efficient way to catch them.</p><p>Static analysis is well-suited here. The bug is structural, not behavioral. It&rsquo;s all about which variable the code references (<code>s.repo</code> vs <code>tx</code>), not about runtime values. The pattern is detectable from source code alone.</p><p>That&rsquo;s why I decided to write a linter. While I use them every day, I wasn&rsquo;t exactly sure how they worked nor where to start. However, writing one seemed like an interesting challenge, so I&rsquo;m sharing what I learned.</p><h2 id=the-goanalysis-framework class="relative group">The <code>go/analysis</code> Framework <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#the-goanalysis-framework aria-label=Anchor>#</a></span></h2><p>The current standard for Go linters is the <a href=https://pkg.go.dev/golang.org/x/tools/go/analysis target=_blank rel=noreferrer><code>go/analysis</code> framework</a>. It makes static analysis surprisingly accessible. The framework lets you focus on the linter logic while it handles all the complexity of parsing, type-checking, and running analyses.</p><p>The package provides a standardized structure for building analyzers with the <code>analysis.Analyzer</code> type:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=nf>NewAnalyzer</span><span class=p>()</span><span class=w> </span><span class=o>*</span><span class=nx>analysis</span><span class=p>.</span><span class=nx>Analyzer</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>analysis</span><span class=p>.</span><span class=nx>Analyzer</span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>Name</span><span class=p>:</span><span class=w>     </span><span class=s>&#34;transactioncheck&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>Doc</span><span class=p>:</span><span class=w>      </span><span class=s>&#34;checks that Transaction callbacks use the transaction-scoped repo parameter&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>Run</span><span class=p>:</span><span class=w>      </span><span class=nx>runTransactionCheck</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>Requires</span><span class=p>:</span><span class=w> </span><span class=p>[]</span><span class=o>*</span><span class=nx>analysis</span><span class=p>.</span><span class=nx>Analyzer</span><span class=p>{</span><span class=nx>inspect</span><span class=p>.</span><span class=nx>Analyzer</span><span class=p>},</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>The <code>Run</code> field contains a function that executes the analysis on a single package. It receives an <code>*analysis.Pass</code> struct containing everything needed for analysis: parsed AST, type information, and a <code>Reportf</code> method for flagging violations.</p><p>The <code>Requires</code> field specifies a list of other analyzers this one depends on. Here, we depend on <code>inspect.Analyzer</code>, which provides an optimized AST traversal mechanism.</p><p>Following Go convention, where linters typically have a <code>check</code> suffix (like <code>staticcheck</code> or <code>nilcheck</code>), I called mine <code>transactioncheck</code>.</p><h2 id=implementation-deep-dive class="relative group">Implementation Deep Dive <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#implementation-deep-dive aria-label=Anchor>#</a></span></h2><div class="flex rounded-md bg-primary-100 px-4 py-3 dark:bg-primary-900"><span class="pe-3 text-primary-400"><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 0C114.6.0.0 114.6.0 256s114.6 256 256 256 256-114.6 256-256S397.4.0 256 0zm0 128c17.67.0 32 14.33 32 32 0 17.67-14.33 32-32 32s-32-14.3-32-32 14.3-32 32-32zm40 256h-80c-13.2.0-24-10.7-24-24s10.75-24 24-24h16v-64h-8c-13.25.0-24-10.75-24-24s10.8-24 24-24h32c13.25.0 24 10.75 24 24v88h16c13.25.0 24 10.75 24 24s-10.7 24-24 24z"/></svg>
</span></span><span class=dark:text-neutral-300>The source code is provided as a <a href=https://github.com/leonhfr/transactioncheck target=_blank rel=noreferrer>standalone repository</a>.</span></div><h3 id=walking-the-ast class="relative group">Walking the AST <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#walking-the-ast aria-label=Anchor>#</a></span></h3><p>Here&rsquo;s the entry point of the analyzer:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=nf>runTransactionCheck</span><span class=p>(</span><span class=nx>pass</span><span class=w> </span><span class=o>*</span><span class=nx>analysis</span><span class=p>.</span><span class=nx>Pass</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=kt>any</span><span class=p>,</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>inspect</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>pass</span><span class=p>.</span><span class=nx>ResultOf</span><span class=p>[</span><span class=nx>inspect</span><span class=p>.</span><span class=nx>Analyzer</span><span class=p>].(</span><span class=o>*</span><span class=nx>inspector</span><span class=p>.</span><span class=nx>Inspector</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>nodeFilter</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=p>[]</span><span class=nx>ast</span><span class=p>.</span><span class=nx>Node</span><span class=p>{(</span><span class=o>*</span><span class=nx>ast</span><span class=p>.</span><span class=nx>CallExpr</span><span class=p>)(</span><span class=kc>nil</span><span class=p>)}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>inspect</span><span class=p>.</span><span class=nf>Preorder</span><span class=p>(</span><span class=nx>nodeFilter</span><span class=p>,</span><span class=w> </span><span class=kd>func</span><span class=p>(</span><span class=nx>n</span><span class=w> </span><span class=nx>ast</span><span class=p>.</span><span class=nx>Node</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>callExpression</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>n</span><span class=p>.(</span><span class=o>*</span><span class=nx>ast</span><span class=p>.</span><span class=nx>CallExpr</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>!</span><span class=nf>isTransactionCall</span><span class=p>(</span><span class=nx>pass</span><span class=p>,</span><span class=w> </span><span class=nx>callExpression</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Analyze the transaction callback...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>We filter for call expressions (<code>*ast.CallExpr</code>). We want to inspect every function or method call, and nothing else. This avoids visiting every node in the AST. Then, if it&rsquo;s a <code>Transaction</code> call, we analyze its callback for violations.</p><h3 id=identifying-transaction-calls class="relative group">Identifying Transaction Calls <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#identifying-transaction-calls aria-label=Anchor>#</a></span></h3><p>Before we can detect misused repositories, we need to determine whether a call is a transaction call. The implementation of this is specific to each codebase.</p><p>First, we need to detect repository interfaces. In our example, we have a unique <code>models.Repo</code> interface. We match it by name (<code>Repo</code>) and package location (<code>example.com/models</code>).</p><p>Now that we can identify repositories, we need to detect transaction calls. In the AST, method calls like <code>repo.DoSomething()</code> are represented as selector expressions (<code>*ast.SelectorExpr</code>), while direct calls like <code>doSomething()</code> are not. We check that the node is a selector expression, the method name is <code>Transaction</code>, and the receiver is a repository interface.</p><h3 id=tracking-the-transaction-parameter class="relative group">Tracking the Transaction Parameter <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#tracking-the-transaction-parameter aria-label=Anchor>#</a></span></h3><p>When we find a transaction call, we extract the first parameter of the callback. This is the transaction-scoped parameter, <code>tx</code>. We need to verify that all operations within the callback use it, which means tracking it while we traverse the callback&rsquo;s AST.</p><p>We capture two things:</p><ul><li>the parameter name (<code>txParameterName</code>) for error messages like &ldquo;should use transaction parameter <code>tx</code>&rdquo;,</li><li>the type object (<code>txParameterObject</code>) for identity comparison.</li></ul><p>In Go&rsquo;s type system, two identifiers referring to the same variable share the same <code>types.Object</code>, which we can compare with a simple equality check <code>==</code>. This allows us to track the transaction parameter without relying on name matching, which would fail anyway if the variable name is shadowed.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=nf>isTransactionParameter</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>pass</span><span class=w> </span><span class=o>*</span><span class=nx>analysis</span><span class=p>.</span><span class=nx>Pass</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>expression</span><span class=w> </span><span class=nx>ast</span><span class=p>.</span><span class=nx>Expr</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>txParameterObject</span><span class=w> </span><span class=nx>types</span><span class=p>.</span><span class=nx>Object</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>)</span><span class=w> </span><span class=kt>bool</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>identifier</span><span class=p>,</span><span class=w> </span><span class=nx>ok</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>expression</span><span class=p>.(</span><span class=o>*</span><span class=nx>ast</span><span class=p>.</span><span class=nx>Ident</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>!</span><span class=nx>ok</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>object</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>pass</span><span class=p>.</span><span class=nx>TypesInfo</span><span class=p>.</span><span class=nx>Uses</span><span class=p>[</span><span class=nx>identifier</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>object</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>object</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>pass</span><span class=p>.</span><span class=nx>TypesInfo</span><span class=p>.</span><span class=nx>Defs</span><span class=p>[</span><span class=nx>identifier</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>object</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=nx>txParameterObject</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h3 id=traversing-the-callback class="relative group">Traversing the Callback <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#traversing-the-callback aria-label=Anchor>#</a></span></h3><p>For each transaction callback we find, we traverse its AST to look for violations. We use <code>ast.Inspect</code> to walk every node:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=nf>checkTransactionCallback</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>pass</span><span class=w> </span><span class=o>*</span><span class=nx>analysis</span><span class=p>.</span><span class=nx>Pass</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>functionBody</span><span class=w> </span><span class=o>*</span><span class=nx>ast</span><span class=p>.</span><span class=nx>BlockStmt</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>ast</span><span class=p>.</span><span class=nf>Inspect</span><span class=p>(</span><span class=nx>functionBody</span><span class=p>,</span><span class=w> </span><span class=kd>func</span><span class=p>(</span><span class=nx>n</span><span class=w> </span><span class=nx>ast</span><span class=p>.</span><span class=nx>Node</span><span class=p>)</span><span class=w> </span><span class=kt>bool</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>callExpr</span><span class=p>,</span><span class=w> </span><span class=nx>ok</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>n</span><span class=p>.(</span><span class=o>*</span><span class=nx>ast</span><span class=p>.</span><span class=nx>CallExpr</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>!</span><span class=nx>ok</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=kc>true</span><span class=w> </span><span class=c1>// The node is not a function call, we keep traversing.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nf>isTransactionCall</span><span class=p>(</span><span class=nx>pass</span><span class=p>,</span><span class=w> </span><span class=nx>callExpr</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=kc>false</span><span class=w> </span><span class=c1>// Stop traversing: nested transactions have their own scope.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Check for violations...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>The traversal stops when it encounters a nested transaction. A nested <code>Transaction</code> call creates its own transaction scope with its own <code>tx</code> parameter. Any code inside that nested callback is outside our current analysis scope and will be analyzed separately when we encounter that transaction call.</p><h3 id=detecting-outer-repository-method-calls class="relative group">Detecting Outer Repository Method Calls <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#detecting-outer-repository-method-calls aria-label=Anchor>#</a></span></h3><p>One violation type happens when we call a method on the outer repository instead of the transaction parameter:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>s</span><span class=p>.</span><span class=nx>repo</span><span class=p>.</span><span class=nf>Transaction</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span><span class=w> </span><span class=kd>func</span><span class=p>(</span><span class=nx>tx</span><span class=w> </span><span class=nx>models</span><span class=p>.</span><span class=nx>Repo</span><span class=p>)</span><span class=w> </span><span class=kt>error</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>user</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>s</span><span class=p>.</span><span class=nx>repo</span><span class=p>.</span><span class=nf>GetUser</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span><span class=w> </span><span class=s>&#34;123&#34;</span><span class=p>)</span><span class=w> </span><span class=c1>// Violation: should use tx.GetUser.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>tx</span><span class=p>.</span><span class=nf>SaveUser</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span><span class=w> </span><span class=nx>user</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>})</span><span class=w>
</span></span></span></code></pre></div><p>We detect this by checking if the receiver of a method call is a repository interface that isn&rsquo;t our transaction parameter:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=nf>checkRepoMethodCall</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>pass</span><span class=w> </span><span class=o>*</span><span class=nx>analysis</span><span class=p>.</span><span class=nx>Pass</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>selectorExpression</span><span class=w> </span><span class=o>*</span><span class=nx>ast</span><span class=p>.</span><span class=nx>SelectorExpr</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>txParameterName</span><span class=w> </span><span class=kt>string</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>txParameterObject</span><span class=w> </span><span class=nx>types</span><span class=p>.</span><span class=nx>Object</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>receiverType</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>pass</span><span class=p>.</span><span class=nx>TypesInfo</span><span class=p>.</span><span class=nf>TypeOf</span><span class=p>(</span><span class=nx>selectorExpression</span><span class=p>.</span><span class=nx>X</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>!</span><span class=nf>isRepoInterface</span><span class=p>(</span><span class=nx>receiverType</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=c1>// Receiver is not a repository interface.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nf>isTransactionParameter</span><span class=p>(</span><span class=nx>pass</span><span class=p>,</span><span class=w> </span><span class=nx>selectorExpression</span><span class=p>.</span><span class=nx>X</span><span class=p>,</span><span class=w> </span><span class=nx>txParameterObject</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=c1>// Using the transaction parameter is correct.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>pass</span><span class=p>.</span><span class=nf>Reportf</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>selectorExpression</span><span class=p>.</span><span class=nx>X</span><span class=p>.</span><span class=nf>Pos</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=s>&#34;using non-transaction repo; should use %q instead&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>txParameterName</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h3 id=detecting-outer-repositories-passed-to-helper-functions class="relative group">Detecting Outer Repositories Passed to Helper Functions <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#detecting-outer-repositories-passed-to-helper-functions aria-label=Anchor>#</a></span></h3><p>The second violation we want to detect is more subtle: it happens when passing the outer repository to a helper function instead of the transaction parameter.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>Service</span><span class=p>)</span><span class=w> </span><span class=nf>CreateUser</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span><span class=w> </span><span class=nx>userID</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=kt>error</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>s</span><span class=p>.</span><span class=nx>repo</span><span class=p>.</span><span class=nf>Transaction</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span><span class=w> </span><span class=kd>func</span><span class=p>(</span><span class=nx>tx</span><span class=w> </span><span class=nx>models</span><span class=p>.</span><span class=nx>Repo</span><span class=p>)</span><span class=w> </span><span class=kt>error</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nf>helperFunction</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span><span class=w> </span><span class=nx>s</span><span class=p>.</span><span class=nx>repo</span><span class=p>,</span><span class=w> </span><span class=nx>userID</span><span class=p>)</span><span class=w> </span><span class=c1>// Violation: should pass tx.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=nf>helperFunction</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span><span class=w> </span><span class=nx>repo</span><span class=w> </span><span class=nx>models</span><span class=p>.</span><span class=nx>Repo</span><span class=p>,</span><span class=w> </span><span class=nx>userID</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=kt>error</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>repo</span><span class=p>.</span><span class=nf>SaveUser</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=nx>User</span><span class=p>{</span><span class=nx>ID</span><span class=p>:</span><span class=w> </span><span class=nx>userID</span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Here, <code>s.repo</code> is passed as an argument, and the helper uses it for database operations outside the transaction. The detection logic is similar to before: check if any argument is a repository interface that isn&rsquo;t the transaction parameter:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=nf>checkCallArguments</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>pass</span><span class=w> </span><span class=o>*</span><span class=nx>analysis</span><span class=p>.</span><span class=nx>Pass</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>callExpression</span><span class=w> </span><span class=o>*</span><span class=nx>ast</span><span class=p>.</span><span class=nx>CallExpr</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>txParameterName</span><span class=w> </span><span class=kt>string</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>txParameterObject</span><span class=w> </span><span class=nx>types</span><span class=p>.</span><span class=nx>Object</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>argument</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>callExpression</span><span class=p>.</span><span class=nx>Args</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>argumentType</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>pass</span><span class=p>.</span><span class=nx>TypesInfo</span><span class=p>.</span><span class=nf>TypeOf</span><span class=p>(</span><span class=nx>argument</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>!</span><span class=nf>isRepoInterface</span><span class=p>(</span><span class=nx>argumentType</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>continue</span><span class=w> </span><span class=c1>// Argument is not a repository interface.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nf>isTransactionParameter</span><span class=p>(</span><span class=nx>pass</span><span class=p>,</span><span class=w> </span><span class=nx>argument</span><span class=p>,</span><span class=w> </span><span class=nx>txParameterObject</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>continue</span><span class=w> </span><span class=c1>// Passing the transaction parameter is correct.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>pass</span><span class=p>.</span><span class=nf>Reportf</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nx>argument</span><span class=p>.</span><span class=nf>Pos</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;passing non-transaction repo to function; should pass %q instead&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nx>txParameterName</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h3 id=recursive-analysis-of-helper-functions class="relative group">Recursive Analysis of Helper Functions <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#recursive-analysis-of-helper-functions aria-label=Anchor>#</a></span></h3><p>Detecting violations at the call site isn&rsquo;t always enough. Consider a chain of helper functions:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>Service</span><span class=p>)</span><span class=w> </span><span class=nf>CreateOrder</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span><span class=w> </span><span class=nx>userID</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=kt>error</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>s</span><span class=p>.</span><span class=nx>repo</span><span class=p>.</span><span class=nf>Transaction</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span><span class=w> </span><span class=kd>func</span><span class=p>(</span><span class=nx>tx</span><span class=w> </span><span class=nx>models</span><span class=p>.</span><span class=nx>Repo</span><span class=p>)</span><span class=w> </span><span class=kt>error</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Ok: passing the transaction callback parameter.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>s</span><span class=p>.</span><span class=nf>processOrder</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span><span class=w> </span><span class=nx>tx</span><span class=p>,</span><span class=w> </span><span class=nx>userID</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>Service</span><span class=p>)</span><span class=w> </span><span class=nf>processOrder</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span><span class=w> </span><span class=nx>repo</span><span class=w> </span><span class=nx>models</span><span class=p>.</span><span class=nx>Repo</span><span class=p>,</span><span class=w> </span><span class=nx>userID</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=kt>error</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Ok: using the repository parameter.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>user</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>repo</span><span class=p>.</span><span class=nf>GetUser</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span><span class=w> </span><span class=nx>userID</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>err</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Ok: passing the transaction callback parameter.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>s</span><span class=p>.</span><span class=nf>finalizeOrder</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span><span class=w> </span><span class=nx>repo</span><span class=p>,</span><span class=w> </span><span class=nx>user</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>Service</span><span class=p>)</span><span class=w> </span><span class=nf>finalizeOrder</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span><span class=w> </span><span class=nx>repo</span><span class=w> </span><span class=nx>models</span><span class=p>.</span><span class=nx>Repo</span><span class=p>,</span><span class=w> </span><span class=nx>user</span><span class=w> </span><span class=o>*</span><span class=nx>User</span><span class=p>)</span><span class=w> </span><span class=kt>error</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Bug: uses s.repo instead of the repo parameter.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>s</span><span class=p>.</span><span class=nx>repo</span><span class=p>.</span><span class=nf>SaveOrder</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=nx>Order</span><span class=p>{</span><span class=nx>UserID</span><span class=p>:</span><span class=w> </span><span class=nx>user</span><span class=p>.</span><span class=nx>ID</span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Taken separately, none of these functions would be flagged. <code>finalizeOrder</code> is not a violation in isolation. It only becomes a bug when called as part of a transaction. To catch this, we need to recursively analyze helper functions.</p><p>When the linter sees <code>s.processOrder(ctx, tx, userID)</code> passing the transaction parameter, it recurses into <code>processOrder</code>, now tracking <code>repo</code> as the transaction parameter. When <code>processOrder</code> calls <code>s.finalizeOrder(ctx, repo, user)</code>, the linter recurses again. Finally, inside <code>finalizeOrder</code>, it detects that <code>s.repo.SaveOrder</code> uses <code>s.repo</code> instead of the <code>repo</code> parameter.</p><p>To prevent infinite loops when helpers call each other, the linter tracks visited functions. This ensures each function is analyzed at most once per transaction.</p><h2 id=testing-with-analysistest class="relative group">Testing with <code>analysistest</code> <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#testing-with-analysistest aria-label=Anchor>#</a></span></h2><p>The <code>go/analysis</code> framework provides <a href=https://pkg.go.dev/golang.org/x/tools/go/analysis/analysistest target=_blank rel=noreferrer><code>analysistest</code></a>, which makes testing Analyzers simple and elegant:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=nf>TestAnalyzer</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>testdata</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>analysistest</span><span class=p>.</span><span class=nf>TestData</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>analysistest</span><span class=p>.</span><span class=nf>Run</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span><span class=w> </span><span class=nx>testdata</span><span class=p>,</span><span class=w> </span><span class=nf>NewAnalyzer</span><span class=p>(),</span><span class=w> </span><span class=s>&#34;transactioncheck&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Test cases then live in <code>testdata/src/transactioncheck</code> and use special <code>// want</code> comments for assertions:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>Service</span><span class=p>)</span><span class=w> </span><span class=nf>IncorrectUsage</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=kt>error</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>s</span><span class=p>.</span><span class=nx>repo</span><span class=p>.</span><span class=nf>Transaction</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span><span class=w> </span><span class=kd>func</span><span class=p>(</span><span class=nx>tx</span><span class=w> </span><span class=nx>models</span><span class=p>.</span><span class=nx>Repo</span><span class=p>)</span><span class=w> </span><span class=kt>error</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>_</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>s</span><span class=p>.</span><span class=nx>repo</span><span class=p>.</span><span class=nf>GetUser</span><span class=p>(</span><span class=w> </span><span class=c1>// want &#34;using non-transaction repo; should use \&#34;tx\&#34; instead&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nx>ctx</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;123&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>Service</span><span class=p>)</span><span class=w> </span><span class=nf>CorrectUsage</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=kt>error</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>s</span><span class=p>.</span><span class=nx>repo</span><span class=p>.</span><span class=nf>Transaction</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span><span class=w> </span><span class=kd>func</span><span class=p>(</span><span class=nx>tx</span><span class=w> </span><span class=nx>models</span><span class=p>.</span><span class=nx>Repo</span><span class=p>)</span><span class=w> </span><span class=kt>error</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>_</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>tx</span><span class=p>.</span><span class=nf>GetUser</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span><span class=w> </span><span class=s>&#34;123&#34;</span><span class=p>)</span><span class=w>  </span><span class=c1>// No &#34;want&#34; comment, should not report.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>The test framework verifies that lines with <code>// want</code> comments produce matching diagnostics and that lines without them produce no diagnostics. This catches both false negatives (missed bugs) and false positives (false reports).</p><p>Code in <code>/testdata/src</code> is isolated from the rest of the codebase, so we need to mock dependencies such as the <code>models.Repo</code> interface. The subdirectories below <code>/testdata/src</code> have to mirror the import path.</p><h2 id=running-the-linter class="relative group">Running the Linter <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#running-the-linter aria-label=Anchor>#</a></span></h2><p>With <code>go/analysis</code>, running the linter is straightforward. Because we only have a single analyzer, we use the <code>singlechecker</code> package. The main function is as simple as:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>singlechecker</span><span class=p>.</span><span class=nf>Main</span><span class=p>(</span><span class=nx>transactioncheck</span><span class=p>.</span><span class=nf>NewAnalyzer</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>This generates a complete CLI with flags for output format, verbosity, and more.</p><p>It&rsquo;s possible to run an analyzer <a href=https://golangci-lint.run/docs/contributing/new-linters target=_blank rel=noreferrer>as part of <code>golangci-lint</code></a> (in fact, they only accept linters written with this framework). Since <code>transactioncheck</code> is not generic to all codebases, proposing it as a public linter didn&rsquo;t make sense.</p><p><code>golangci-lint</code> also supports private linters, but that would require building a custom binary and configuring every developer&rsquo;s editor to use it. This was not practical.</p><p>For this reason, a custom linter is best run as a standalone tool. For example, at work we use <a href=https://mise.jdx.dev/ target=_blank rel=noreferrer>mise</a> as a task runner, so it&rsquo;s easy to integrate it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-toml data-lang=toml><span class=line><span class=cl><span class=p>[</span><span class=nx>tasks</span><span class=p>.</span><span class=nx>lint</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>depends_post</span> <span class=p>=</span> <span class=s2>&#34;transactioncheck&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>run</span> <span class=p>=</span> <span class=s1>&#39;golangci-lint run -v&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>tasks</span><span class=p>.</span><span class=nx>build-transactioncheck</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>sources</span> <span class=p>=</span> <span class=p>[</span><span class=s2>&#34;./tools/transactioncheck/**/*.go&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>run</span> <span class=p>=</span> <span class=s1>&#39;go build -o bin/transactioncheck tools/transactioncheck/cmd/main.go&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>tasks</span><span class=p>.</span><span class=nx>transactioncheck</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>depends</span> <span class=p>=</span> <span class=s2>&#34;build-transactioncheck&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>run</span> <span class=p>=</span> <span class=s1>&#39;bin/transactioncheck ./...&#39;</span>
</span></span></code></pre></div><p>The <code>depends</code> key ensures the linter is built before it runs. The <code>depends_post</code> key runs <code>transactioncheck</code> after <code>golangci-lint</code>.</p><p>Finally, I added the linter to CI. New violations now break the build, preventing these bugs from reaching production.</p><h2 id=you-should-write-your-own-linter class="relative group">You Should Write Your Own Linter <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#you-should-write-your-own-linter aria-label=Anchor>#</a></span></h2><p>When I first ran <code>transactioncheck</code>, it found multiple violations across the codebase. These were not hypothetical bugs. Thankfully, none were in services handling financial data, as those get more diligent review, but the risk was real.</p><p>What started as frustration with transaction bugs became a two-day project that now protects the entire codebase. The linter runs in seconds, catches a whole class of bugs at compile time, and has required almost no maintenance since.</p><p>If your team has code patterns that are easy to get wrong, consider building a custom linter!</p></div></section><footer class="max-w-prose pt-8 print:hidden"><div class=flex><picture class="!mb-0 !mt-0 me-4 w-24 h-auto rounded-full"><img width=512 height=512 class="!mb-0 !mt-0 me-4 w-24 h-auto rounded-full" alt="léon h" loading=lazy decoding=async src=https://leonh.fr/img/author.jpg></picture><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">Author</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">léon h</div><div class="text-sm text-neutral-700 dark:text-neutral-400">Software engineer, former architect (as in, buildings).</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400" style=will-change:transform href=mailto:hello@leonh.fr target=_blank aria-label=Email rel="me noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg>
</span></a><a class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400" style=will-change:transform href=https://github.com/leonhfr target=_blank aria-label=Github rel="me noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></a><a class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400" style=will-change:transform href=https://instagram.com/leonholl target=_blank aria-label=Instagram rel="me noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M224.1 141c-63.6.0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1.0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9.0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9.0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9.0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9.0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8.0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"/></svg>
</span></a><a class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400" style=will-change:transform href=https://linkedin.com/in/leonhollender target=_blank aria-label=Linkedin rel="me noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg></span></a></div></div></div></div><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="group flex" href=https://leonh.fr/posts/mockgen-source-mode/><span class="me-2 text-neutral-700 transition-transform group-hover:-translate-x-[2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"><span class="ltr:inline rtl:hidden">&larr;</span><span class="ltr:hidden rtl:inline">&rarr;</span></span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">One mockgen flag can make your CI 5x faster</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2025-11-01 00:00:00 +0000 UTC">1 November 2025</time>
</span></span></a></span><span></span></div></div><div class=pt-3><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class=pt-3><script src=https://utteranc.es/client.js repo=leonhfr/blog theme=photon-dark label issue-term=pathname crossorigin=anonymous async></script></div></div></footer></article></main><div class="pointer-events-none absolute bottom-0 end-0 top-[100vh] w-12" id=to-top hidden=true><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div><footer class="py-10 print:hidden"><div class="flex items-center justify-between"><div><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2026
léon h</p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://github.com/jpanther/congo target=_blank rel="noopener noreferrer">Congo</a></p></div><div class="flex flex-row items-center"></div></div></footer></div></body></html>