<!DOCTYPE html>


    

<html lang="en-us" data-theme="dark">
<head>
    
        
<meta charset="utf-8">
<meta name="HandheldFriendly" content="True">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer-when-downgrade">

<title>Simple shell script subcommands - leon h</title>

<meta name="description" content="Description">





<link rel="icon" type="image/x-icon" href="https://leonh.fr/favicon.ico">
<link rel="apple-touch-icon-precomposed" href="https://leonh.fr/favicon.png">


<style>
  body {
    visibility: hidden;
    opacity: 0;
  }
</style>

<noscript>
  <style>
    body {
      visibility: visible;
      opacity: 1;
    }
  </style>
</noscript>



    





    
    
        
    
    

    
        <link rel="stylesheet" href="https://leonh.fr/css/style.min.13a89a414695151c90154917248ef5f78d427316f306079d0a3c69fa0536af02.css" integrity="sha256-E6iaQUaVFRyQFUkXJI71941CcxbzBgedCjxp&#43;gU2rwI=">
    





    

    





    
    
        
    
    

    
        <script type="module" src="https://leonh.fr/js/script.min.74bf1a3fcf1af396efa4acf3e660e876b61a2153ab9cbe1893ac24ea6d4f94ee.js" type="text/javascript" charset="utf-8" integrity="sha256-dL8aP88a85bvpKzz5mDodrYaIVOrnL4Yk6wk6m1PlO4="></script>
    







    





    
    
        
    
    

    
        <script type="module" src="https://leonh.fr/js/script.min.66560da8b02da8ef781849dc9ba649043b675ddf656826916e29d66943750872.js" type="text/javascript" charset="utf-8" integrity="sha256-ZlYNqLAtqO94GEncm6ZJBDtnXd9laCaRbinWaUN1CHI="></script>
    






<meta property="og:url" content="https://leonh.fr/simple-shell-script-subcommands/">
  <meta property="og:site_name" content="leon h">
  <meta property="og:title" content="Simple shell script subcommands">
  <meta property="og:description" content="Description">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2022-10-01T00:00:00+00:00">
    <meta property="article:modified_time" content="2022-10-01T00:00:00+00:00">


  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Simple shell script subcommands">
  <meta name="twitter:description" content="Description">



    
        <link rel="webmention" href="https://webmention.io/leonh.fr/webmention" />
        
            <link rel="pingback" href="https://webmention.io/leonh.fr/xmlrpc" />
        
    
    






  <script async defer data-website-id="f9a943bd-0bea-4967-b412-dde5a177f799" src="https://umami-gbw2hc98w-leonhfr.vercel.app/umami.js"></script>


    
</head>
<body>
    <a class="skip-main" href="#main">Skip to main content</a>
    <div class="container">
        <header class="common-header"> 
            
                <div class="header-top">
    <h1><a href="/">leon h</a></h1>

    
        
        
        <h2><a class="" href="https://leonh.fr/about/" title="">about</a></h2>
        
        <h2><a class="" href="https://leonh.fr/posts/" title="">archive</a></h2>
        
    
    <ul class="social-icons">

    <li>
        <span id="search_btn" title="Search">
            <span class="inline-svg" >




    
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg>

</span>

        </span>
    </li>


    
        <li>
            <a href="https://github.com/leonhfr" title="Github" rel="me">
            <span class="inline-svg" >




    
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

</span>

            </a>
        </li>
    

    
        <li>
            <a href="https://www.linkedin.com/in/leonhollender" title="Linkedin" rel="me">
            <span class="inline-svg" >




    
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>

</span>

            </a>
        </li>
    



    <li>
            <a href="https://leonh.fr/index.xml" title="RSS" rel="me">
            <span class="inline-svg" >




    
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M128.081 415.959c0 35.369-28.672 64.041-64.041 64.041S0 451.328 0 415.959s28.672-64.041 64.041-64.041 64.04 28.673 64.04 64.041zm175.66 47.25c-8.354-154.6-132.185-278.587-286.95-286.95C7.656 175.765 0 183.105 0 192.253v48.069c0 8.415 6.49 15.472 14.887 16.018 111.832 7.284 201.473 96.702 208.772 208.772.547 8.397 7.604 14.887 16.018 14.887h48.069c9.149.001 16.489-7.655 15.995-16.79zm144.249.288C439.596 229.677 251.465 40.445 16.503 32.01 7.473 31.686 0 38.981 0 48.016v48.068c0 8.625 6.835 15.645 15.453 15.999 191.179 7.839 344.627 161.316 352.465 352.465.353 8.618 7.373 15.453 15.999 15.453h48.068c9.034-.001 16.329-7.474 16.005-16.504z"/></svg>

</span>

            </a>
        </li>
    

</ul>

<div id="search_menu_wrapper" class="hidden">
  <div id="search_menu">
      <div id="search_menu_toolbar">
          <div id="search_menu_input_wrapper">
              <input id="search_menu_input" type="text" placeholder='Search'>
          </div>
          <div id="search_menu_close_btn">
              <span class="inline-svg" >




    
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L160 210.7 54.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L114.7 256 9.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L160 301.3 265.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L205.3 256 310.6 150.6z"/></svg>

</span>

          </div>
      </div>
      <div id="search_menu_results">
      </div>
  </div>
</div>


</div>



            
        </header>
        <main id="main" tabindex="-1"> 
            
    

    <article class="post h-entry">
        <div class="post-header">
            <header>
                <h1 class="p-name post-title">Simple shell script subcommands</h1>

                
            </header>
        </div>
        <div class="content e-content">
            <p>Shell scripts are awesome, <a href="https://leonh.fr/help-message-for-shell-scripts/">as we know</a>. Now, we have nice shell scripts that self document. But if you&rsquo;re anything like me, then you have lots of them in your <code>~/bin</code> or wherever you put them. One reason for that is that each script can do one thing and one thing only. Wouldn&rsquo;t it be nice if we could group different functionalities in the same file?</p>
<p>Some CLIs already do that with subcommands. Think <code>git add</code> or <code>go get</code>. We&rsquo;re going to check how to simply have subcommands with shell scripts.</p>
<p>First, we put each functionality in its own function. Each function should be prefixed <code>sub_</code>. Of course, we have the documentation at the top and a help function to parse and print it. Note that each function also has a comment.</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#cd2828;font-weight:bold">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic">###</span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic">### my-script — does several things well</span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic">###</span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic">### Usage: my-script [options] &lt;subcommand&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic">###</span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic">### Options:</span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic">###   -h,--help: Show this message.</span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic">###</span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic">### Subcommands:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic">### help: show this message</span>
</span></span><span style="display:flex;"><span>sub_help() {
</span></span><span style="display:flex;"><span>  sed -rn <span style="color:#ed9d13">&#39;s/^### ?//p&#39;</span> <span style="color:#ed9d13">&#34;</span><span style="color:#40ffff">$0</span><span style="color:#ed9d13">&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic">### foo: do some the foo thing</span>
</span></span><span style="display:flex;"><span>sub_foo() {
</span></span><span style="display:flex;"><span>    <span style="color:#24909d">echo</span> <span style="color:#ed9d13">&#34;Running the foo subcommand&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic">### bar: do the bar thing, which is related but different to the foo thing</span>
</span></span><span style="display:flex;"><span>sub_bar() {
</span></span><span style="display:flex;"><span>    <span style="color:#24909d">echo</span> <span style="color:#ed9d13">&#34;Running the bar subcommand&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#24909d">echo</span> <span style="color:#ed9d13">&#34;We can use first argument with &#39;</span><span style="color:#40ffff">$1</span><span style="color:#ed9d13">&#39;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#24909d">echo</span> <span style="color:#ed9d13">&#34;The second argument is &#39;</span><span style="color:#40ffff">$2</span><span style="color:#ed9d13">&#39;, and so on&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Then, at the end of the script, we put this piece of magic:</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#40ffff">SCRIPT_NAME</span>=<span style="color:#6ab825;font-weight:bold">$(</span>basename <span style="color:#40ffff">$0</span><span style="color:#6ab825;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#40ffff">SUBCOMMAND</span>=<span style="color:#40ffff">$1</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">case</span> <span style="color:#40ffff">$SUBCOMMAND</span> in
</span></span><span style="display:flex;"><span>  <span style="color:#ed9d13">&#34;&#34;</span> | <span style="color:#ed9d13">&#34;-h&#34;</span> | <span style="color:#ed9d13">&#34;--help&#34;</span>)
</span></span><span style="display:flex;"><span>    sub_help
</span></span><span style="display:flex;"><span>    ;;
</span></span><span style="display:flex;"><span>  *)
</span></span><span style="display:flex;"><span>    <span style="color:#24909d">shift</span>
</span></span><span style="display:flex;"><span>    sub_<span style="color:#ed9d13">${</span><span style="color:#40ffff">SUBCOMMAND</span><span style="color:#ed9d13">}</span> <span style="color:#40ffff">$@</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6ab825;font-weight:bold">if</span> [ <span style="color:#40ffff">$?</span> = <span style="color:#3677a9">127</span> ]; <span style="color:#6ab825;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>      <span style="color:#24909d">echo</span> <span style="color:#ed9d13">&#34;Error: &#39;</span><span style="color:#40ffff">$SUBCOMMAND</span><span style="color:#ed9d13">&#39; is not a known subcommand.&#34;</span> &gt;&amp;<span style="color:#3677a9">2</span>
</span></span><span style="display:flex;"><span>      <span style="color:#24909d">echo</span> <span style="color:#ed9d13">&#34;       Run &#39;</span><span style="color:#40ffff">$SCRIPT_NAME</span><span style="color:#ed9d13"> --help&#39; for a list of known subcommands.&#34;</span> &gt;&amp;<span style="color:#3677a9">2</span>
</span></span><span style="display:flex;"><span>      <span style="color:#24909d">exit</span> <span style="color:#3677a9">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6ab825;font-weight:bold">fi</span>
</span></span><span style="display:flex;"><span>    ;;
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">esac</span>
</span></span></code></pre></div><p>What&rsquo;s happening here? Some notes:</p>
<ul>
<li>we store the name of the script with <code>basename</code>;</li>
<li>we use a bash <a href="https://linuxize.com/post/bash-case-statement/">case statement</a>;</li>
<li>we check the first argument, the subcommand, if it&rsquo;s one of <code>-h</code>, <code>--help</code> or an empty string, we print the help and exit;</li>
<li>otherwise (see the <code>*)</code> which is the default case), we:
<ul>
<li>use the <code>shift</code> command to shift positional parameters to the left, so command name which was in <code>$1</code> is placed at <code>$0</code> instead, and so on for other arguments;</li>
<li>we execute the subcommand function with the repositioned arguments <code>$@</code>;</li>
<li>if the subcommand doesn&rsquo;t exist, we print an error message using the script name.</li>
</ul>
</li>
</ul>
<p>Now the cool thing about this is that not only can we add as many subcommands as we like, but the help message also gets updated with the subcommand comments, so the script is still self documenting.</p>
<p>Printing the help:</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ my-script --help
</span></span><span style="display:flex;"><span>my-script — does several things well
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Usage: my-script [options] &lt;subcommand&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Options:
</span></span><span style="display:flex;"><span>  -h,--help: Show this message.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Subcommands:
</span></span><span style="display:flex;"><span>help: show this message
</span></span><span style="display:flex;"><span>foo: <span style="color:#6ab825;font-weight:bold">do</span> some the foo thing
</span></span><span style="display:flex;"><span>bar: <span style="color:#6ab825;font-weight:bold">do</span> the bar thing, which is related but different to the foo thing
</span></span></code></pre></div><p>Running the bar subcommand:</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ my-script bar hello world
</span></span><span style="display:flex;"><span>Running the bar subcommand
</span></span><span style="display:flex;"><span>We can use first argument with <span style="color:#ed9d13">&#39;hello&#39;</span>
</span></span><span style="display:flex;"><span>The second argument is <span style="color:#ed9d13">&#39;world&#39;</span>, and so on
</span></span></code></pre></div><p>Command who doesn&rsquo;t exist:</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ my-script hello
</span></span><span style="display:flex;"><span>Error: <span style="color:#ed9d13">&#39;hello&#39;</span> is not a known subcommand.
</span></span><span style="display:flex;"><span>       Run <span style="color:#ed9d13">&#39;my-script --help&#39;</span> <span style="color:#6ab825;font-weight:bold">for</span> a list of known subcommands.
</span></span></code></pre></div>
        </div>
        

    


<div class="post-info">
    
        <div class="post-date dt-published">Oct 01, 2022</div>
    

    <a class="post-hidden-url u-url" href="https://leonh.fr/simple-shell-script-subcommands/">https://leonh.fr/simple-shell-script-subcommands/</a>
    <a href="https://leonh.fr/" class="p-name p-author post-hidden-author h-card" rel="me">leon h</a>


    <div class="post-taxonomies">
        
            
    </div>
</div>

    </article>

    

    
        
    <div class="pagination post-pagination">
        <div class="left pagination-item disabled">
            
        </div>
        <div class="right pagination-item ">
            
                <a href="/help-message-for-shell-scripts/">Help message for shell scripts</a>
            
        </div>
    </div>


    

    
         


<script src="https://utteranc.es/client.js"
        repo="leonhfr/blog"
        theme="github-dark"
        label=""
        issue-term="pathname"
        crossorigin="anonymous"
        async>
</script> 
    

        </main>
        
            <footer class="common-footer">
    
    

    <div class="common-footer-bottom">
        
        <div class="copyright">
            
              Say hi: <a href="mailto:hello@leonh.fr" rel="me">hello@leonh.fr</a><br />All content is published under the <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> license.
            
        </div>

        

    




<script>
const STORAGE_KEY = 'user-color-scheme'
const defaultTheme = "dark-without-switcher"

let currentTheme
let switchButton
let autoDefinedScheme = window.matchMedia('(prefers-color-scheme: dark)')

const autoChangeScheme = e => {
    currentTheme = e.matches ? 'dark' : 'light'
    document.documentElement.setAttribute('data-theme', currentTheme)
    changeButtonText()
}

document.addEventListener('DOMContentLoaded', function() {
    switchButton = document.querySelector('.theme-switcher')
    currentTheme = detectCurrentScheme()
    if (currentTheme == 'dark') {
        document.documentElement.setAttribute('data-theme', 'dark')
    }
    if (currentTheme == 'auto') {
        autoChangeScheme(autoDefinedScheme);
        autoDefinedScheme.addListener(autoChangeScheme);
    }

    if (switchButton) {
        changeButtonText()
        switchButton.addEventListener('click', switchTheme, false)
    }
  
    showContent()
})

function detectCurrentScheme() {
    if (localStorage.getItem(STORAGE_KEY)) {
        return localStorage.getItem(STORAGE_KEY)
    } 
    if (defaultTheme) {
        return defaultTheme
    } 
    if (!window.matchMedia) {
        return 'light'
    } 
    if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        return 'dark'
    }
    return 'light'
}

function changeButtonText()
{   
    if (switchButton) {
        switchButton.textContent = currentTheme == 'dark' ?  "Light theme" : "Dark theme"
    }
}

function switchTheme(e) {
    if (currentTheme == 'dark') {
        localStorage.setItem(STORAGE_KEY, 'light')
        document.documentElement.setAttribute('data-theme', 'light')
        currentTheme = 'light'
    } else {
        localStorage.setItem(STORAGE_KEY, 'dark')
        document.documentElement.setAttribute('data-theme', 'dark')
        currentTheme = 'dark'
    }
    changeButtonText()
}

function showContent() {
    document.body.style.visibility = 'visible';
    document.body.style.opacity = 1;
}
</script>
    </div>

    <p class="h-card vcard">

    <a href=https://leonh.fr/ class="p-name u-url url fn" rel="me">Leon Hollender</a> 

    

    
</p> 
</footer>

        
    </div>
</body>
</html>
